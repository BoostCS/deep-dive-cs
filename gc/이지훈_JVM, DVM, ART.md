## JVM (Java Virtual Machine)
> JVM은 자바 바이트 코드를 실행할 수 있는 주체이다. 
- 자바 바이트 코드는 플랫폼에 독립적이며, JVM 의존적으로 실행된다.
- 플랫폼에 맞춰 소스코드를 빌드할 필요 없다.
- 한 번의 빌드로 여러 플랫폼에서 실행할 수 있다. (Write Once And Run Anywhere)

### JVM에서 코드를 실행하는 방법

![image](https://user-images.githubusercontent.com/53300830/208838512-f797e661-a602-404d-ae50-f66edfae1b80.png)

- 하나의 A.java 소스 파일을 갖고 있고, 이를 Java 컴파일러에 의해 바이트 코드로 변경하며 A.class 파일로 만들어진다.
- 윈도우, 맥, 리눅스 어느 플랫폼이라도 JVM만 동작되는 환경이라면 새로 컴파일이 필요 없이 A.class를 실행할 수 있다.

### JVM의 특성
- 스택 기반의 가상 머신
- 단일 상속형태의 객체 지향 프로그래밍을 가상 머신 수준에서 구현
- 가비지 컬렉션 사용
- 포인터를 지원하지만 C와 같이 주소 값을 임의로 조작이 가능한 포인터 연산이 불가능

## DVM
> 안드로이드 애플리케이션을 실행할 수 있는 가상 머신이다.
- 모바일 기기 특성상 배터리 수명, 컴퓨팅 파워 및 메모리가 데스크탑에 비해 열약하다.
- 모바일 기기 환경에 맞게 최적화 되어 나온 가상 머신이 DVM이다.

![image](https://user-images.githubusercontent.com/53300830/208839433-93f5afed-b35b-452c-8829-41b1d1099060.png)
APK가 만들어 만들어지는 과정이다.
- JVM에서 실행되는 자바 바이트 코드로 변환되는 동일한 과정을 거치지만 마지막 두 단계가 다르다.
- Dex 컴파일러는 class 파일을 dex 파일로 변경하여 DVM에서 실행가능하게 만든다.
- 여러 개의 class 파일이 하나의 dex 파일로 변경되며, 최종적으로 dex, 리소스를 포함한 기타 라이브러리 등이 압축돼 APK가 완성된다.

==DVM은 다중 인스턴스로 실행되도록 설계 됐기 때문에 효율적이며 어플리케이션 자체적인 VM 인스턴스가 제공된다.==

### DVM이 선택받았던 이유

==빠르다==
- 안드로이드 DVM을 사용하는 가장 큰 이유중 하나가 JVM이 사용한 스택 기반 모델 대신 레지스터 기반 모델을 사용한다는 점이다.
- JVM은 스택 기반 모델은 많은 메모리를 요구하며, 안드로이드에서는 빠른 성능을 낼 수 없다.
- DVM은 레지스터 기반 모델은이기에 메모리 사용량이 적기 때문에 빠르게 동작이 가능하다.

==라이센스 문제==
- 안드로이드에서 JVM을 사용할 경우에 발생할 수 있는 라이센스 관련된 문제를 피하기 위해 새로운 가상머신 도입이 필요
- JVM은 공짜였지만 GPL 라이센스이며, 안드로이드와 관련된 내용들은 Apache 라이센스가 대다수였기 때문에 JVM을 사용하는 것은 적합하지 않았다.
	- 여담으로 일부 자바 API 사용에 대해 오라클에 고소를 당했고, 결국 패소를 했다는 이야기가 있다.

## ART
> ART(Android RunTime)은 안드로이드 애플리케이션 런타임 환경으로 새로운 디버깅 기능과 좀 더 정확한 고수준의 애플리케이션 프로파일링 기능을 제공한다.

- 구글이 DVM에서 ART로 변경한 이유 중 하나는 퍼포먼스 개선이다.
- 이것이 가능한 이유는 컴파일러 언어와 인터프리터 언어의 차이를 알아야만 한다.

### Compiler / Interpreter
<img src="https://user-images.githubusercontent.com/53300830/208844059-282831a5-c864-44fa-83d7-23620b78deea.png"  width="600" height="300"/>

- 컴파일러 언어와 Interpreter 언어의 가장 큰 차이점은 컴파일을 수행하는 시점이다.
- 간단하게 생각하면 런타임 전에 컴파일을 수행하면 컴파일언어이고, 런타임에 컴파일을 수행하면 interpreter 언어이다.
- 컴파일러 언어는 미리 컴파일을 해두기 때문에 빠른 실행속도라는 이점을 갖고 있다.
	- 대신 플랫폼 종속성과 디스크 공간 활용이 단점이다.
	- 대표적으로 C, C++, C#등이 컴파일러 언어가 있다.
- interpreter 언어는 런타임 중에 한줄씩 해석하며 실행하기 때문에 컴파일러 언어보다 느리지만 코드 변경시 즉시 실행이 가능하다는 장점이 있다
	- 자바스크립트, 파이썬 SQL 루비 등이 interpreter 언어에 속한다.

==자바의 경우는 javac(컴파일러)를 통해 컴파일된다.==
- 결과로 바이트 코드를 얻기 때문에 컴파일러 언어이다.
- VM에서 바이트 코드를 다시 기계어로 변환한다는 점에서 인터프리터 언어의 특징도 갖고 있다.

## DVM과 ART 컴파일러 (JIT vs AOT)
> Android 5.0(API21) 이상에서는 ART가 기본 런타임 환경이다.
- Dalvik과 ART의 가장 큰 차이점은 컴파일 방식이다.
- Dalvik은 JIT방식을 사용하고 ART는 AOT방식을 사용한다.
	- Anroid 7.0 부터는 AOT와 JIT를 조합해서 사용한다.

### JIT은 DVM 내부의 컴파일러이다.
- 어플리케이션의 바이트 코드를 가상머신에서 기계어로 번역한 결과를 캐쉬에 저장한다.
- 그렇기에 다시 해당 바이트 코드를 실행해야 하는 경우 캐쉬의 내용을 불러오기 때문에 퍼포먼스가 개선됐다.
- 하지만 별도의 메모리 캐시가 필요하다는 점에서 interpreter 방식보다 더 많은 메모리 공간이 필요로 한다.

### AOT는 ART 내부의 컴파일러이다.
- DVM의 JIT와는 달리 애플리케이션이 설치되는 시점에 애플리케이션 전체 바이트 코드를 기계어로 번역한다.
- 설치시간이 오래걸린다는 단점이 존재하지만, 런타임에서 바이트 코드를 해석하는 시간을 제거했기 때문에 전체적인 퍼포먼스가 좋아지고 배터리 수명이 향상되게 된다.

<img src="https://user-images.githubusercontent.com/53300830/208908503-66d0a339-4f7a-4ff9-a7a1-dac060988215.png"  width="500" height="250"/>

Google I/O 2014



### 참고 자료 
https://www.charlezz.com/?p=42686
https://aboullaite.me/understanding-jit-compiler-just-in-time-compiler/
http://source.android.google.cn/devices/tech/dalvik/gc-debug